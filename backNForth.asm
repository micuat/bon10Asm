LIST
	INCLUDE p16f84a.inc

	__CONFIG _CP_OFF & _PWRTE_ON & _WDT_OFF & _XT_OSC

	CBLOCK	0x20
	CNT1
	CNT2
	CNT3
	CNT4
	TEMP
	ENDC

	ORG 0
MAIN
	BSF		STATUS,RP0
	MOVLW	000H
	MOVWF	OPTION_REG
	CLRF	INTCON
	MOVLW	B'11110000'
	MOVWF	TRISA
	MOVLW	B'00111100'
	MOVWF	TRISB
	BCF		STATUS,RP0
	MOVLW	B'00000011'
	MOVWF	PORTB

LOOP
; Debug: DIP to motor
;	MOVF	PORTB, W
;	MOVWF	TEMP
;	RRF		TEMP, f
;	RRF		TEMP, W
;	MOVWF	PORTA
	
	BTFSC	PORTB, 2
	GOTO	STANDBY

	CALL	GOSTRAIGHT
	CALL	TIM100
	CALL	TIM100
	CALL	TIM100
	CALL	TIM100
	CALL	TIM100
	CALL	TIM100
	CALL	TIM100
	CALL	TIM100
	CALL	TIM100
	CALL	TIM100
	CALL	GOBACK
	CALL	TIM100
	CALL	TIM100
	CALL	TIM100
	CALL	TIM100
	CALL	TIM100
	CALL	TIM100
	CALL	TIM100
	CALL	TIM100
	CALL	TIM100
	CALL	TIM100


	GOTO	LOOP

STANDBY
	MOVLW	B'00000000'
	MOVWF	PORTA
	GOTO	LOOP
; STANDBY

GOSTRAIGHT
	MOVLW	B'00000011'
	MOVWF	PORTA
	RETURN
; GOSTRAIGHT

GOBACK
	MOVLW	B'00001100'
	MOVWF	PORTA
	RETURN
; GOBACK


TIM10
	MOVLW	0C7H	;199
	MOVWF	CNT1
TIMLP1
	NOP
	NOP
	DECFSZ	CNT1,F
	GOTO	TIMLP1	;2+5*199-1=996
	RETURN		;996+2=998*0.4usec=0.4msec
TIM100
	MOVLW	0F9H	;249 
	MOVWF	CNT2
TIMLP2
	CALL	TIM10	;2+(1000+3)*249-1=249748
	DECFSZ	CNT2,F
	GOTO	TIMLP2
	RETURN

	END
